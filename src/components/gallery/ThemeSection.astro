---
export interface GalleryImage {
  src: string
  alt: string
  orientation?: 'portrait' | 'landscape'
}

export interface ThemeSectionProps {
  id: string
  title: string
  subtitle: string
  number: string
  bgClass: string
  headingClass: string
  subtitleClass: string
  dividerClass: string
  countClass: string
  images: GalleryImage[]
}

interface Props {
  theme: ThemeSectionProps
}

type LayoutPattern = 'single-center' | 'single-left' | 'single-right' | 'two-side' | 'single-wide'

interface PhotoGroup {
  pattern: LayoutPattern
  photos: GalleryImage[]
}

function buildPhotoGroups(photos: GalleryImage[]): PhotoGroup[] {
  const groups: PhotoGroup[] = []
  let i = 0
  let patternCycle = 0

  const portraitCycle: { pattern: LayoutPattern; count: number }[] = [
    { pattern: 'single-center', count: 1 },
    { pattern: 'two-side', count: 2 },
    { pattern: 'single-right', count: 1 },
    { pattern: 'single-center', count: 1 },
    { pattern: 'single-left', count: 1 },
    { pattern: 'two-side', count: 2 },
  ]

  while (i < photos.length) {
    const current = photos[i]

    if (current.orientation === 'landscape') {
      groups.push({ pattern: 'single-wide', photos: [current] })
      i++
      continue
    }

    const cycleEntry = portraitCycle[patternCycle % portraitCycle.length]

    if (cycleEntry.count === 2) {
      const next = photos[i + 1]
      if (next && next.orientation !== 'landscape') {
        groups.push({ pattern: 'two-side', photos: [current, next] })
        i += 2
      } else {
        groups.push({ pattern: 'single-center', photos: [current] })
        i++
      }
    } else {
      groups.push({ pattern: cycleEntry.pattern, photos: [current] })
      i++
    }

    patternCycle++
  }

  return groups
}

const { theme } = Astro.props
const photoGroups = buildPhotoGroups(theme.images)
const photoCount = theme.images.length
---

<section id={theme.id} class={`${theme.bgClass} py-20 md:py-28`}>
  <div class="mx-auto max-w-6xl px-6">
    <!-- Header -->
    <div class="mb-12 flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <p class={`text-[10px] tracking-[0.3em] uppercase mb-3 ${theme.subtitleClass}`}>
          Theme {theme.number}
        </p>
        <h2 class={`font-serif text-4xl md:text-5xl font-normal mb-3 ${theme.headingClass}`}>
          {theme.title}
        </h2>
        <div class={`w-10 h-px ${theme.dividerClass} mb-3`}></div>
        <p class={`text-sm max-w-sm leading-relaxed ${theme.subtitleClass}`}>
          {theme.subtitle}
        </p>
      </div>
      <p
        class={`font-serif text-7xl md:text-8xl font-light leading-none select-none ${theme.countClass}`}
      >
        {photoCount}
      </p>
    </div>

    <!-- Photo groups -->
    <div class="py-8 md:py-12">
      <div class="flex flex-col gap-20 md:gap-28 lg:gap-36">
        {
          photoGroups.map((group) => {
            if (group.pattern === 'single-center') {
              return (
                <div class="mx-auto w-full max-w-sm md:max-w-md">
                  <div class="relative w-full overflow-hidden" style="aspect-ratio: 2/3">
                    <img
                      src={group.photos[0].src}
                      alt={group.photos[0].alt}
                      loading="lazy"
                      class="absolute inset-0 h-full w-full object-cover transition-transform duration-700 hover:scale-[1.03]"
                    />
                  </div>
                </div>
              )
            }
            if (group.pattern === 'single-wide') {
              return (
                <div class="mx-auto w-full max-w-2xl lg:max-w-3xl">
                  <div class="relative w-full overflow-hidden" style="aspect-ratio: 3/2">
                    <img
                      src={group.photos[0].src}
                      alt={group.photos[0].alt}
                      loading="lazy"
                      class="absolute inset-0 h-full w-full object-cover transition-transform duration-700 hover:scale-[1.03]"
                    />
                  </div>
                </div>
              )
            }
            if (group.pattern === 'single-left') {
              return (
                <div class="mr-auto w-full max-w-sm md:max-w-md md:pl-8 lg:pl-16">
                  <div class="relative w-full overflow-hidden" style="aspect-ratio: 2/3">
                    <img
                      src={group.photos[0].src}
                      alt={group.photos[0].alt}
                      loading="lazy"
                      class="absolute inset-0 h-full w-full object-cover transition-transform duration-700 hover:scale-[1.03]"
                    />
                  </div>
                </div>
              )
            }
            if (group.pattern === 'single-right') {
              return (
                <div class="ml-auto w-full max-w-sm md:max-w-md md:pr-8 lg:pr-16">
                  <div class="relative w-full overflow-hidden" style="aspect-ratio: 2/3">
                    <img
                      src={group.photos[0].src}
                      alt={group.photos[0].alt}
                      loading="lazy"
                      class="absolute inset-0 h-full w-full object-cover transition-transform duration-700 hover:scale-[1.03]"
                    />
                  </div>
                </div>
              )
            }
            if (group.pattern === 'two-side') {
              return (
                <div class="flex flex-col items-center gap-10 md:flex-row md:items-start md:gap-8 lg:gap-12">
                  <div class="w-full max-w-xs md:max-w-none md:flex-1">
                    <div class="relative w-full overflow-hidden" style="aspect-ratio: 2/3">
                      <img
                        src={group.photos[0].src}
                        alt={group.photos[0].alt}
                        loading="lazy"
                        class="absolute inset-0 h-full w-full object-cover transition-transform duration-700 hover:scale-[1.03]"
                      />
                    </div>
                  </div>
                  <div class="w-full max-w-xs md:mt-16 md:max-w-none md:flex-1 lg:mt-24">
                    <div class="relative w-full overflow-hidden" style="aspect-ratio: 2/3">
                      <img
                        src={group.photos[1].src}
                        alt={group.photos[1].alt}
                        loading="lazy"
                        class="absolute inset-0 h-full w-full object-cover transition-transform duration-700 hover:scale-[1.03]"
                      />
                    </div>
                  </div>
                </div>
              )
            }
          })
        }
      </div>

      <!-- Back to top -->
      <div class="mt-16 text-center">
        <a
          href="#top"
          class={`text-[10px] tracking-[0.25em] uppercase ${theme.subtitleClass} hover:opacity-100 transition-opacity`}
        >
          â†‘ Back to top
        </a>
      </div>
    </div>
  </div>
</section>
